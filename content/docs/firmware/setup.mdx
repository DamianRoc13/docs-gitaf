---
title: Configuración del Entorno
description: Guía paso a paso para configurar el entorno de desarrollo ESP32
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Steps, Step } from 'fumadocs-ui/components/steps';

## Requisitos del Sistema

Antes de comenzar, asegúrate de tener:

| Componente | Requisito Mínimo | Recomendado |
|------------|------------------|-------------|
| **Sistema Operativo** | Windows 10, macOS 10.14, Ubuntu 18.04 | Windows 11, macOS 13+, Ubuntu 22.04 |
| **RAM** | 4 GB | 8 GB+ |
| **Espacio en Disco** | 2 GB libres | 5 GB+ |
| **Procesador** | Dual-core 2.0 GHz | Quad-core 2.5 GHz+ |
| **Puerto USB** | USB 2.0 | USB 3.0 |

## Opción 1: Arduino IDE (Recomendado para Principiantes)

<Steps>

<Step>
### Instalar Arduino IDE

1. Descarga Arduino IDE 2.x desde [arduino.cc](https://www.arduino.cc/en/software)
2. Instala siguiendo el wizard de instalación
3. Abre Arduino IDE

<Callout type="info">
Arduino IDE 2.x tiene mejor soporte para ESP32 y autocompletado de código.
</Callout>
</Step>

<Step>
### Configurar el Board Manager para ESP32

1. Abre **Archivo → Preferencias** (o `Ctrl+,`)
2. En **"URLs Adicionales de Gestor de Tarjetas"**, agrega:
   ```
   https://espressif.github.io/arduino-esp32/package_esp32_index.json
   ```
3. Click **OK**
</Step>

<Step>
### Instalar el Paquete ESP32

1. Ve a **Herramientas → Placa → Gestor de tarjetas**
2. Busca **"esp32"**
3. Instala **"esp32 by Espressif Systems"** (versión 2.0.14 o superior)
4. Espera a que termine la instalación (~5 minutos)

<Callout type="warn">
La primera instalación puede tardar debido a la descarga de herramientas de compilación (~500 MB).
</Callout>
</Step>

<Step>
### Seleccionar la Placa

1. Ve a **Herramientas → Placa → esp32**
2. Selecciona **"ESP32 Dev Module"**
3. Configura los siguientes parámetros:

| Configuración | Valor |
|---------------|-------|
| Upload Speed | 921600 |
| CPU Frequency | 240MHz (WiFi/BT) |
| Flash Frequency | 80MHz |
| Flash Mode | QIO |
| Flash Size | 4MB (32Mb) |
| Partition Scheme | Default 4MB with spiffs |
| Core Debug Level | None |
| PSRAM | Disabled |

</Step>

<Step>
### Instalar Driver USB (si es necesario)

**Windows**: Instala [CP210x USB to UART Driver](https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers)

**macOS**: Generalmente no requiere drivers adicionales

**Linux**: Agrega tu usuario al grupo `dialout`:
```bash
sudo usermod -a -G dialout $USER
```
Luego cierra sesión y vuelve a entrar.
</Step>

<Step>
### Verificar Conexión

1. Conecta tu ESP32 al puerto USB
2. Ve a **Herramientas → Puerto** y selecciona el puerto COM/ttyUSB correspondiente
3. Abre el **Monitor Serie** (`Ctrl+Shift+M`)
4. Configura baud rate a **115200**

**Probar con sketch básico**:
```cpp
void setup() {
  Serial.begin(115200);
  Serial.println("ESP32 conectado!");
}

void loop() {
  Serial.println("Funcionando...");
  delay(1000);
}
```

Click **Upload** (→). Si ves "Hard resetting via RTS pin...", ¡funcionó!
</Step>

</Steps>

## Opción 2: PlatformIO (Para Usuarios Avanzados)

PlatformIO ofrece mejor gestión de librerías y proyectos más complejos.

<Steps>

<Step>
### Instalar VS Code

1. Descarga [Visual Studio Code](https://code.visualstudio.com/)
2. Instala siguiendo el asistente
</Step>

<Step>
### Instalar Extensión PlatformIO

1. Abre VS Code
2. Ve a **Extensions** (`Ctrl+Shift+X`)
3. Busca **"PlatformIO IDE"**
4. Click **Install**
5. Reinicia VS Code cuando se solicite
</Step>

<Step>
### Crear Nuevo Proyecto

1. Click en el ícono de PlatformIO en la barra lateral
2. Click **"New Project"**
3. Configura:
   - **Name**: gitaf-firmware
   - **Board**: Espressif ESP32 Dev Module
   - **Framework**: Arduino
   - **Location**: Donde prefieras
4. Click **Finish**

<Callout type="info">
PlatformIO descargará automáticamente todas las herramientas necesarias (~1 GB).
</Callout>
</Step>

<Step>
### Configurar platformio.ini

Edita el archivo `platformio.ini` en la raíz del proyecto:

```ini
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Configuración de compilación
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio

; Monitor serial
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Librerías necesarias
lib_deps = 
    espressif/esp_now
    bblanchon/ArduinoJson @ ^6.21.3

; Flags de compilación
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DBOARD_HAS_PSRAM
```
</Step>

<Step>
### Compilar y Subir

1. Conecta el ESP32
2. Click en el ícono **"→"** (Upload) en la barra inferior
3. O usa `Ctrl+Alt+U`

**Comandos útiles**:
- **Build**: `Ctrl+Alt+B`
- **Upload**: `Ctrl+Alt+U`
- **Serial Monitor**: `Ctrl+Alt+S`
- **Clean**: `Ctrl+Alt+C`
</Step>

</Steps>

## Librerías Necesarias

Independientemente del IDE que uses, necesitarás estas librerías:

### Para Arduino IDE

Instala via **Sketch → Incluir Librería → Administrar Librerías**:

| Librería | Versión | Descripción |
|----------|---------|-------------|
| **ESP32** | ≥2.0.14 | Core de ESP32 (ya instalado) |
| **ArduinoJson** | ^6.21.3 | Manejo de datos JSON |
| **AsyncTCP** | latest | TCP asíncrono (opcional) |

### Para PlatformIO

Ya están definidas en `platformio.ini` (ver arriba).

<Callout type="info">
ESP-NOW viene incluido en el core de ESP32, no necesitas instalarlo por separado.
</Callout>

## Estructura del Proyecto

Organiza tu código de esta manera:

```
gitaf-firmware/
├── src/
│   ├── main.cpp              # Archivo principal
│   ├── config.h              # Configuraciones
│   ├── esp_now_manager.cpp   # Gestión ESP-NOW
│   ├── esp_now_manager.h
│   ├── audio_manager.cpp     # Control de audio
│   ├── audio_manager.h
│   ├── bluetooth_manager.cpp # (Solo maestro)
│   └── bluetooth_manager.h
├── include/
│   └── definitions.h         # Definiciones globales
├── lib/                      # Librerías custom
├── test/                     # Tests unitarios
└── platformio.ini           # Configuración PlatformIO
```

### Para Arduino IDE

```
Documentos/Arduino/
├── gitaf_master/            # Proyecto maestro
│   ├── gitaf_master.ino
│   ├── config.h
│   ├── esp_now_manager.cpp
│   ├── esp_now_manager.h
│   └── bluetooth_manager.cpp
└── gitaf_slave/             # Proyecto esclavo
    ├── gitaf_slave.ino
    ├── config.h
    ├── esp_now_manager.cpp
    └── audio_manager.cpp
```

## Configuración Inicial del Código

### Archivo config.h

Crea este archivo en tu proyecto:

```cpp
#ifndef CONFIG_H
#define CONFIG_H

// Información del dispositivo
#define DEVICE_TYPE "MASTER"  // o "SLAVE_LEFT", "SLAVE_CENTER", "SLAVE_RIGHT"
#define FIRMWARE_VERSION "1.0.0"

// Pines
#define LED_PIN 2
#define AUDIO_PIN 25        // Solo esclavos
#define BATTERY_PIN 34      // Monitoreo de batería

// Configuración ESP-NOW
#define ESPNOW_CHANNEL 1    // Canal WiFi (1-13)
#define ESPNOW_MAX_RETRY 3

// Direcciones MAC de los esclavos
uint8_t slaveLeft[] = {0x24, 0x6F, 0x28, 0xXX, 0xXX, 0xXX};
uint8_t slaveCenter[] = {0x24, 0x6F, 0x28, 0xXX, 0xXX, 0xXX};
uint8_t slaveRight[] = {0x24, 0x6F, 0x28, 0xXX, 0xXX, 0xXX};

// Configuración Bluetooth (solo maestro)
#define BLE_DEVICE_NAME "GITAF-Master"
#define BLE_SERVICE_UUID "4fafc201-1fb5-459e-8fcc-c5c9c331914b"

// Configuración de Audio
#define AUDIO_FREQUENCY 2000  // Hz
#define AUDIO_DURATION 1000   // ms
#define AUDIO_VOLUME 128      // 0-255

// Delays y timeouts
#define MAIN_LOOP_DELAY 100
#define WATCHDOG_TIMEOUT 8000  // ms

#endif
```

### Sketch Básico de Prueba

```cpp
#include "config.h"

void setup() {
  Serial.begin(115200);
  pinMode(LED_PIN, OUTPUT);
  
  Serial.println("\n=== GITAF Firmware ===");
  Serial.print("Dispositivo: ");
  Serial.println(DEVICE_TYPE);
  Serial.print("Versión: ");
  Serial.println(FIRMWARE_VERSION);
  
  // Test LED
  for(int i = 0; i < 3; i++) {
    digitalWrite(LED_PIN, HIGH);
    delay(200);
    digitalWrite(LED_PIN, LOW);
    delay(200);
  }
  
  Serial.println("Setup completado!");
}

void loop() {
  digitalWrite(LED_PIN, HIGH);
  delay(500);
  digitalWrite(LED_PIN, LOW);
  delay(500);
}
```

<Callout type="success">
Si el LED parpadea, tu entorno está correctamente configurado. ¡Continúa con la implementación de ESP-NOW!
</Callout>

## Obtener Dirección MAC del ESP32

Necesitarás las direcciones MAC de cada ESP32:

```cpp
#include <WiFi.h>

void setup() {
  Serial.begin(115200);
  WiFi.mode(WIFI_MODE_STA);
  
  Serial.print("Dirección MAC: ");
  Serial.println(WiFi.macAddress());
}

void loop() {}
```

Sube este código a cada ESP32 y anota sus MACs.

## Comandos Útiles del Monitor Serial

| Comando | Descripción |
|---------|-------------|
| `Ctrl+C` | Salir del monitor |
| `Ctrl+T` | Menú de opciones |
| `Ctrl+]` | Aumentar baud rate |
| `Ctrl+[` | Disminuir baud rate |
| `Ctrl+R` | Habilitar/deshabilitar echo |
| `Ctrl+H` | Ayuda |

## Troubleshooting

### No Detecta el Puerto COM

**Windows**:
```powershell
# Ver dispositivos USB
Get-PnpDevice -Class Ports
```

**Linux/macOS**:
```bash
ls /dev/tty* | grep -E "(USB|ACM)"
```

### Error "Failed to connect to ESP32"

1. Mantén presionado **BOOT** en el ESP32
2. Click **Upload** en Arduino IDE
3. Cuando veas "Connecting...", suelta **BOOT**

### Error de Permisos (Linux)

```bash
sudo chmod 666 /dev/ttyUSB0
# O permanentemente:
sudo usermod -a -G dialout $USER
```

### Reinstalar Drivers (Windows)

1. Device Manager → Ports
2. Click derecho en CP210x → Desinstalar
3. Desconecta ESP32
4. Reinstala driver
5. Reconecta ESP32

## Próximos Pasos

Con el entorno configurado, continúa con:

- [Comunicación Inalámbrica](/docs/firmware/communication): Implementación de ESP-NOW
- [Lógica de Audio](/docs/firmware/audio): Generación de señales de audio
- [Solución de Problemas](/docs/support/troubleshooting): Debugging avanzado

## Recursos Adicionales

- [Documentación oficial ESP32](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/)
- [Arduino ESP32 GitHub](https://github.com/espressif/arduino-esp32)
- [PlatformIO Docs](https://docs.platformio.org/en/latest/platforms/espressif32.html)
- [ESP32 Pinout Reference](https://randomnerdtutorials.com/esp32-pinout-reference-gpios/)
