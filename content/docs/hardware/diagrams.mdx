---
title: Diagramas de Conexión
description: Esquemas eléctricos detallados y pinout para el ensamblaje de los nodos GITAF PRO
---

import { Callout } from 'fumadocs-ui/components/callout';

## Arquitectura de Hardware Unificada

El sistema GITAF PRO utiliza un diseño de hardware estandarizado. Tanto el **Maestro** como los **Esclavos** comparten el mismo circuito electrónico. La diferenciación se realiza únicamente a través del software.

### Diagrama de Bloques Funcional

```mermaid
graph TD
    subgraph "Etapa de Potencia"
    Bat[Batería LiPo 2S (7.4V)] --> Switch[Interruptor]
    Switch --> INA[Sensor INA219]
    INA --> Reg[Regulador LM2596]
    Reg -->|5.0V Regulado| Bus5V[Bus de Energía 5V]
    end

    subgraph "Etapa de Control"
    Bus5V --> ESP[ESP32 VIN]
    ESP <-->|I2C: 21/22| INA
    ESP -->|GPIO: 25/26/27| LED[LED RGB]
    end

    subgraph "Etapa de Audio"
    Bus5V --> AMP[Amplificador PAM8403]
    Bus5V --> MP3[DFPlayer Mini]
    ESP -->|UART: 4/5| MP3
    MP3 -->|Audio L/R| AMP
    Cap[Capacitor 1000uF] -.->|Filtro| AMP
    AMP --> Spk[Parlante 5W]
    end

```

## Guía de Conexión Paso a Paso

### 1. Sistema de Energía (Power Management)

Esta es la etapa más crítica. Una mala conexión aquí puede quemar los componentes.

| Origen | Destino | Cable | Notas |
| --- | --- | --- | --- |
| **Batería (+)** | **INA219 (Vin+)** | Rojo (Grueso) | Entrada directa de batería |
| **Batería (-)** | **INA219 (GND)** | Negro (Grueso) | Tierra común |
| **INA219 (Vin-)** | **LM2596 (IN+)** | Rojo | Salida del sensor al regulador |
| **GND Común** | **LM2596 (IN-)** | Negro | Tierra común |
| **LM2596 (OUT+)** | **BUS 5V (+)** | Rojo | **¡AJUSTAR A 5V ANTES DE CONECTAR!** |
| **LM2596 (OUT-)** | **BUS 5V (-)** | Negro | Tierra común del sistema |

<Callout type="danger" title="¡Calibración Obligatoria!">
El módulo LM2596 suele venir de fábrica con el voltaje alto. Antes de conectar el ESP32 o el Audio, usa un multímetro y gira el tornillo dorado del LM2596 hasta que la salida marque exactamente **5.0V**.
</Callout>

### 2. Conexión del Cerebro (ESP32)

Alimentación y periféricos básicos.

| Pin ESP32 | Conexión | Función |
| --- | --- | --- |
| **VIN** | BUS 5V (+) | Entrada de energía principal |
| **GND** | BUS 5V (-) | Tierra |
| **GPIO 21** | INA219 (SDA) | Datos I2C (Sensor Batería) |
| **GPIO 22** | INA219 (SCL) | Reloj I2C (Sensor Batería) |
| **GPIO 25** | LED RGB (Rojo) | Indicador Estado |
| **GPIO 26** | LED RGB (Verde) | Indicador Estado |
| **GPIO 27** | LED RGB (Azul) | Indicador Estado |

### 3. Módulo de Audio (DFPlayer + PAM8403)

Configuración para eliminar ruido ("Soplido").

| Pin Origen | Pin Destino | Componente Intermedio |
| --- | --- | --- |
| **ESP32 (GPIO 4)** | DFPlayer (RX) | - |
| **ESP32 (GPIO 5)** | DFPlayer (TX) | Resistencia 1kΩ (Recomendado) |
| **BUS 5V (+)** | DFPlayer (VCC) | - |
| **GND** | DFPlayer (GND) | - |
| **DFPlayer (DAC_R)** | PAM8403 (L_IN) | - |
| **DFPlayer (DAC_L)** | PAM8403 (R_IN) | - |
| **GND** | PAM8403 (GND Audio) | - |
| **BUS 5V (+)** | PAM8403 (VCC) | **Capacitor 1000uF (Filtro)** |

## Diagrama Esquemático (Pinout Map)

Visualización de las conexiones en la placa ESP32 (Vista Superior).

```text
                  ┌─────────────────────────┐
                  │      ESP32 DEVKIT V1    │
                  └────────────┬────────────┘
        [Energía]              │
  (Bus 5V+) ──── VIN  [30] ┌───┴───┐ [1]  3V3 ── (No usado)
      (GND) ──── GND  [29] │       │ [2]  EN
  (INA SDA) ──── D13  [28] │       │ [3]  VP
  (INA SCL) ──── D12  [27] │       │ [4]  VN
 (LED Azul) ──── D27  [26] │       │ [5]  D34
(LED Verde) ──── D26  [25] │       │ [6]  D35
 (LED Rojo) ──── D25  [24] │       │ [7]  D32
                D33  [23] │       │ [8]  D33
                D32  [22] │       │ [9]  D25
                D35  [21] │       │ [10] D26
                D34  [20] │       │ [11] D27
                 VN  [19] │       │ [12] D14
                 VP  [18] │       │ [13] D12
                 EN  [17] │       │ [14] D13 
                      ...              ...
         (MP3 RX) ──── D5   [X] │       │ [Y]  D4 ──── (MP3 TX)
                  └─────────────────────────┘

```

## Checklist de Verificación de Montaje

Antes de cerrar la caja y encender, verifica los siguientes puntos críticos:

1. **Polaridad del Capacitor:** La franja blanca/negra del capacitor de 1000uF debe estar conectada estrictamente a **GND**.
2. **Dirección del INA219:** Asegúrate de que `Vin+` venga de la batería y `Vin-` vaya hacia el circuito. Si lo pones al revés, leerá carga negativa.
3. **Aislamiento:** Verifica que la parte trasera del DFPlayer o del ESP32 no esté tocando metal o soldaduras de otros componentes.
4. **Voltaje:** Mide nuevamente el Bus de 5V. Si pasa de 5.5V, podrías dañar el PAM8403 o el DFPlayer.

## Solución de Problemas Comunes en Hardware

| Síntoma | Causa Probable | Solución |
| --- | --- | --- |
| **Ruido fuerte (Zumbido)** | Falta de Tierra Común o Capacitor | Soldar el capacitor de 1000uF directamente en los pines de alimentación del PAM8403. |
| **El LED parpadea rojo** | INA219 desconectado | Revisar cables SDA/SCL (GPIO 21 y 22). |
| **Audio suena distorsionado** | Batería baja o Volumen alto | Cargar batería o bajar volumen en el código (default 25). |
| **No enciende** | LM2596 mal calibrado | Girar tornillo del regulador en sentido anti-horario muchas vueltas. |
