---
title: Funcionalidad de GITAF
description: Desglose funcional y lógica de operación del sistema GITAF PRO
---

import { Cards, Card } from 'fumadocs-ui/components/card';
import { Callout } from 'fumadocs-ui/components/callout';

## Diagrama de Funcionalidad

![GITAF Diagram](../assets/diagram.jpg)

El sistema **GITAF PRO** opera bajo un modelo de **inteligencia distribuida**. A diferencia de los altavoces Bluetooth convencionales que solo reproducen lo que se les envía, cada nodo en GITAF tiene su propia lógica de decisión, temporizadores y gestión de energía.

## Módulos del Sistema

### 1. Interfaz de Control (App Android)
La aplicación no transmite audio, sino **instrucciones lógicas**. Esto garantiza que la conexión sea rápida y estable incluso a largas distancias.

- **Selección de Objetivo:** Permite activar independientemente el **Maestro (Local)**, **Esclavo 1** o **Esclavo 2**.
- **Panel de Telemetría:** Decodifica y visualiza en tiempo real el porcentaje de carga de las tres baterías, alertando al entrenador si algún nodo baja del 20%.
- **Conexión Transparente:** Se vincula automáticamente al dispositivo identificado como **"Gitaf Pro"**.

### 2. Módulo Maestro (Nodo Híbrido)
El ESP32 central actúa como el cerebro de la red, desempeñando tres funciones simultáneas:

1.  **Gateway de Comunicaciones:** Traduce los comandos Bluetooth de la App a paquetes ESP-NOW para los esclavos.
2.  **Emisor de Audio Local:** Posee su propio amplificador y altavoz. Al recibir el comando `"11"`, ejecuta su propia secuencia de sonido para servir como punto de referencia central o posición del entrenador.
3.  **Concentrador de Datos:** Recibe los reportes de voltaje de los esclavos, los unifica con su propia lectura (INA219) y envía un paquete consolidado a la App.

### 3. Módulos Esclavos (Nodos Satélite)
Los dispositivos ubicados en las porterías son totalmente autónomos. Su funcionalidad se basa en el principio de **"Activación por Eventos"**:

- **Secuenciador Automático:** Al recibir la señal de activación, el esclavo inicia un bucle local: *Reproducir → Esperar 3 seg → Reproducir*.
- **Auto-Apagado Inteligente:** Tras cumplir **3 ciclos** de reproducción, el dispositivo corta el audio automáticamente y entra en modo de espera (Standby) para maximizar la batería.
- **Retorno de Estado:** Cada 2 segundos, despierta su radio brevemente para enviar su nivel de batería al Maestro.

## Lógica de Operación

El sistema está programado para evitar la saturación auditiva y facilitar la orientación mediante secuencias predecibles.

### Ciclo de Disparo de Audio
Cada vez que el entrenador presiona un botón en la App, ocurre la siguiente secuencia lógica en el hardware:

```mermaid
graph LR
    A[Inicio: Comando APP] --> B{¿Es Local o Remoto?}
    
    B -- Local (Maestro) --> C[Activar DFPlayer Local]
    B -- Remoto (Esclavo) --> D[Enviar Trama ESP-NOW]
    
    C --> E[Bucle: 3 Repeticiones]
    D --> F[Esclavo Recibe Señal]
    
    F --> G[Bucle Esclavo: 3 Repeticiones]
    
    E --> H[Standby Automático]
    G --> H